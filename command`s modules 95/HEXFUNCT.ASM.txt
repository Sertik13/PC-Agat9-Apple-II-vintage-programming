


*------------------*
* ôóíêöèÿ "HEX$"(n)*
*------------------*

; ïðåîáðàçóåò àðãóìåíò n â äèàïàçîíå 0-65535
; â øåñòíàäöàòèðè÷íóþ òåêñòîâóþ ñòðîêó


HEX      DFB:10010000
         DW  RAM
         DFB 1,1
         DFB 0,0
         ASC "HEX$ (n)"
         DFB 0

BUFHEX   EQU $06
HEXS     EQU $2A

         LDA BUF1         ïðåîáðàçîâàòü àðãóìåíò
         JSR TREOR        èç áóôåðà
         STA BUFHEX+3     ìëàäøèé
         STY BUFHEX+2
         LDA BUF11        ñòàðøèé
         JSR TREOR
         STA BUFHEX+1
         STY BUFHEX
         LDX#4            óáðàòü ëèäèðóþùèå íóëè
         LDY#0            ----------------------
HEXC     LDA BUFHEX,Y     X-ñ÷åò÷èê öèôð
         CMP#$30          ýòî íîëü?
         BNE HEXRET
         DEX              äà, ïðîïóñòèòü
         INY
         CPY#4
         BNE HEXC
         DEY
         INX              íîëü òîæå öèôðà!
HEXRET   TYA
         STA HEXS         âåðíóòü ïàðàìåòð îáðàáîò÷èêó
         LDA#>BUFHEX      ôóíêöèé
         CLC
         ADC HEXS
         TAY
         LDA#<BUFHEX
         ADC#0
         RTS
         
TREOR    JSR TRHEX
         EOR#$80
         PHA
         TYA
         EOR#$80
         TAY
         PLA      
         RTS

TRHEX    PHA
         LSR A
         LSR A
         LSR A
         LSR A
         JSR TRBYTE
         TAY
         PLA
         AND#:00001111
TRBYTE   ORA#$B0
         CMP#$BA
         BCC TREND
         ADC#6
TREND    RTS

