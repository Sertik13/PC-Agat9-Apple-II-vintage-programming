

*==================*
* îïåðàòîð "RESET" *
*==================*

; ïðîöåäóðà RESET ïåðåóñòàíàâëèâàåò âåêòîðà ñáðîñà
; ñèñòåìû DOS 3.3 è Áåéñèê òàê, ÷òî ïîñëå ÓÏÐ-ÑÁÐ
; ñèñòåìà ïåðåõîäèò ê âûïîëíåíèþ êîìàíäû "RUN"
; (òî åñòü çàïóñêà Áåéñèê-ïðîãðàììû.
; &"RESET"1 âûïîëíÿåò óêàçàííûå âûøå äåéñòâèÿ
; &"RESET"0 âîçâðàùàåò âåêòîðà â èñõîäíîå ñîñòîÿíèå


RESET    DFB:00001000
         DW TURBO
         DFB 1,1
         DFB 0,0
         ASC "RESET n"
         DFB 0

RESET1   JSR CH.PARH      ïðîâåðèòü ïàðàìåòð
         LDA BUF1
         BEQ RESOFF       åñëè îí ðàâåí 0, òî âûêëþ÷èòü
         CMP#2
         BCS RESERR46     2 è áîëåå íåëüçÿ
         LDA RESFLAG      ïàðàìåòð ðàâåí 1-óñòàíîâèòü
         BNE RESOFF1      ñáðîñ íà BASIC "RUN"
RESON    LDX $3F3         (åñëè RESFLAG=1, òî RESET óæå
         LDY $3F2          óñòàíîâëåí)
         STX RESH
         STY RESL
         INC RESFLAG
         LDY#>RESPROC
         LDA#<RESPROC
RESON1   STY $3F2
         STA $3F3
         EOR#$A5
         STA $3F4
         RTS
RESOFF   LDA RESFLAG      åñëè RESFLAG=0, òî 
         BEQ RESOFF1      RESET íå áûë óñòàíîâëåí è
         LDA RESH         âûêëþ÷àòü íå÷åãî
         LDY RESL
         JSR RESON1
         LDA#0
         STA RESFLAG
RESOFF1  RTS 

RESERR46 JMP BASERR46

RESL     DS 1
RESH     DS 1
RESFLAG  DS 1              ôëàã 

RESPROC  LDA#$44           ïðîöåäóðà ñáðîñà íà "RUN"
         STA $E8
         STA $56C
         JSR $3CB
         JSR $1889
         STA $C080
         LDX $56C
         STA $C100,X
         STA $C110,X
         JSR $D699
         JSR $1841
         JSR $D68B
         LDA#$00
         STA $D8
         STA $33
         JSR $184A
         JMP $D4FA

